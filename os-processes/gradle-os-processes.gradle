/**
 * This Gradle script captures OS processes as reported by the OS 'ps' command, as custom value.
 */

buildScan.background {
    def psOutput = execAndGetStdout('ps', '-o pid,ppid,time,command')
    buildScan.value 'OS processes', psOutput
}

static String execAndGetStdout(String... args) {
    def exec = args.toList().execute()
    exec.waitFor()
    trimAtEnd(exec.text)
}

static String trimAtEnd(String str) {
    ('x' + str).trim().substring(1)
}
